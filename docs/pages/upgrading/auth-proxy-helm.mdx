---
title: Upgrading Self-Hosted Teleport Clusters on Kubernetes
description: Explains how to upgrade the Teleport Auth Service and Proxy Service when self-hosting Teleport on Kubernetes
---

This guide explains how to upgrade Teleport Auth Service and Proxy Service
instances running on Kubernetes.

## Prerequisites

- Familiarity with the [Upgrading Compatibility Overview](./overview.mdx) guide,
  which describes the sequence in which to upgrade components of your cluster.
- A Teleport cluster deployed with the `teleport-cluster` Helm chart. 

This guide assumes that you have configured the `teleport-cluster` Helm chart
with a values file called `values.yaml`, and that your `teleport-cluster`
release is called `teleport-cluster`.

## Step 1/2. Edit your `teleport-cluster` values file

You must reduce the number of Auth Service instances to one in order to ensure a
consistent cluster state and enable the Auth Service to perform any data
migrations.

Ensure that your `teleport-cluster` values file includes the followinmg
configuration:

```yaml
auth:
  highAvailability:
    replicaCount: 1
```

 Once the upgrade is finished, you can configure your cluster for high
 availability again.

## Step 2/2. Upgrade your `teleport-cluster` Helm release

Run the following commands to upgrade Auth Service and Proxy Service instances
running on Kubernetes.

1. Update the Teleport Helm chart repository so you can install the latest
   version of the `teleport-cluster` chart:

  (!docs/pages//kubernetes-access/helm/includes/helm-repo-add.mdx!)

1. Upgrade the Helm release:

  ```code
  $ helm upgrade teleport-cluster teleport-cluster --version=(=teleport.version=) --values=values.yaml
  ```

The `teleport-cluster` Helm chart automatically waits for the previous version
of the Proxy Service to stop responding to requests before running a new version
of the Auth Service.

## Next steps

Now that you have upgraded the Auth Service and Proxy Service, you can upgrade
the agents in your Teleport cluster.

We recommend that Teleport users set up automatic agent upgrades, where agents
query a **version server** in order to determine whether they are out of date
and need to install a new version of Teleport. Read one of the following guides
to set up automatic agent upgrades:

- [Self-hosted Teleport clusters](./upgrading//self-hosted-automatic-agent-updates.mdx)
- [Teleport Cloud](./upgrading//enroll-agent-into-automatic-updates.mdx)

For special circumstances, you can also read about how to upgrade agents
manually in your environment (the instructions are the same for self-hosted and
Teleport Cloud clusters):

- [Kubernetes](./upgrading/agents-helm.mdx)
- [Linux Servers](./upgrading/agents-linux.mdx)

